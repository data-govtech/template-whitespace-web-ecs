{
  "Resources": {
    "EcsCluster97242B84": {
      "Type": "AWS::ECS::Cluster",
      "Properties": {
        "ClusterName": "whitespace-web-template-cluster"
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/EcsCluster/Resource"
      }
    },
    "taskrole5938D619": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/AmazonDynamoDBFullAccess"
              ]
            ]
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/AmazonSQSFullAccess"
              ]
            ]
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/AmazonSESFullAccess"
              ]
            ]
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/AmazonS3FullAccess"
              ]
            ]
          }
        ],
        "PermissionsBoundary": "arn:aws:iam::305326993135:policy/GCCIAccountBoundary",
        "RoleName": "whitespace-web-template-task-role"
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/task-role/Resource"
      }
    },
    "executionroleD9A39BE6": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PermissionsBoundary": "arn:aws:iam::305326993135:policy/GCCIAccountBoundary",
        "RoleName": "whitespace-web-template-execution-role"
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/execution-role/Resource"
      }
    },
    "executionroleDefaultPolicy497F11A3": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
                "ecr:GetAuthorizationToken",
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":ecr:ap-southeast-1:904766938874:repository/",
                    {
                      "Fn::ImportValue": "whitespace-web-template-EcrRepositoryName"
                    }
                  ]
                ]
              }
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "FargateTaskcontainerLogGroupBC85644B",
                  "Arn"
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "executionroleDefaultPolicy497F11A3",
        "Roles": [
          {
            "Ref": "executionroleD9A39BE6"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/execution-role/DefaultPolicy/Resource"
      }
    },
    "FargateTaskB0B28A1D": {
      "Type": "AWS::ECS::TaskDefinition",
      "Properties": {
        "ContainerDefinitions": [
          {
            "Environment": [
              {
                "Name": "API_HOST",
                "Value": ""
              },
              {
                "Name": "DB_HOST",
                "Value": ""
              }
            ],
            "Essential": true,
            "Image": {
              "Fn::Join": [
                "",
                [
                  "904766938874.dkr.ecr.ap-southeast-1.",
                  {
                    "Ref": "AWS::URLSuffix"
                  },
                  "/",
                  {
                    "Fn::ImportValue": "whitespace-web-template-EcrRepositoryName"
                  },
                  ":latest"
                ]
              ]
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "FargateTaskcontainerLogGroupBC85644B"
                },
                "awslogs-stream-prefix": "whitespace-web-template-fargate-logs",
                "awslogs-region": "ap-southeast-1"
              }
            },
            "Memory": 512,
            "Name": "container",
            "PortMappings": [
              {
                "ContainerPort": 80,
                "Protocol": "tcp"
              }
            ]
          }
        ],
        "Cpu": "256",
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "executionroleD9A39BE6",
            "Arn"
          ]
        },
        "Family": "whitespace-web-template-fargate-task",
        "Memory": "1024",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": [
          "FARGATE"
        ],
        "TaskRoleArn": {
          "Fn::GetAtt": [
            "taskrole5938D619",
            "Arn"
          ]
        }
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/FargateTask/Resource"
      }
    },
    "FargateTaskcontainerLogGroupBC85644B": {
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain",
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/FargateTask/container/LogGroup/Resource"
      }
    },
    "ecssecuritygroupE15CB9D2": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "whitespace-web-template-fargate/ecs-security-group",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "VpcId": "vpc-12345"
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/ecs-security-group/Resource"
      }
    },
    "ecssecuritygroupfromwhitespacewebtemplatefargatealbSecurityGroupEF821E1580DB37AB63": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "IpProtocol": "tcp",
        "Description": "Load balancer to target",
        "FromPort": 80,
        "GroupId": {
          "Fn::GetAtt": [
            "ecssecuritygroupE15CB9D2",
            "GroupId"
          ]
        },
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "albSecurityGroup49866104",
            "GroupId"
          ]
        },
        "ToPort": 80
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/ecs-security-group/from whitespacewebtemplatefargatealbSecurityGroupEF821E15:80"
      }
    },
    "ecssecuritygroupfromwhitespacewebtemplatefargatealbsecuritygroup845591DC801E559027": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "IpProtocol": "tcp",
        "Description": "Load balancer to target",
        "FromPort": 80,
        "GroupId": {
          "Fn::GetAtt": [
            "ecssecuritygroupE15CB9D2",
            "GroupId"
          ]
        },
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "albsecuritygroup4B3C20F7",
            "GroupId"
          ]
        },
        "ToPort": 80
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/ecs-security-group/from whitespacewebtemplatefargatealbsecuritygroup845591DC:80"
      }
    },
    "ecssecuritygroupfromwhitespacewebtemplatefargatealbsecuritygroup845591DCALLPORTSC815EA8D": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "IpProtocol": "tcp",
        "Description": "ALB to Fargate",
        "FromPort": 0,
        "GroupId": {
          "Fn::GetAtt": [
            "ecssecuritygroupE15CB9D2",
            "GroupId"
          ]
        },
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "albsecuritygroup4B3C20F7",
            "GroupId"
          ]
        },
        "ToPort": 65535
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/ecs-security-group/from whitespacewebtemplatefargatealbsecuritygroup845591DC:ALL PORTS"
      }
    },
    "fargateserviceService16837280": {
      "Type": "AWS::ECS::Service",
      "Properties": {
        "Cluster": {
          "Ref": "EcsCluster97242B84"
        },
        "DeploymentConfiguration": {
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50
        },
        "DesiredCount": 1,
        "EnableECSManagedTags": false,
        "HealthCheckGracePeriodSeconds": 60,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "container",
            "ContainerPort": 80,
            "TargetGroupArn": {
              "Ref": "targetgrouphttp79FCCF53"
            }
          }
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "ENABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": [
                  "ecssecuritygroupE15CB9D2",
                  "GroupId"
                ]
              }
            ],
            "Subnets": []
          }
        },
        "PlatformVersion": "1.4.0",
        "TaskDefinition": {
          "Ref": "FargateTaskB0B28A1D"
        }
      },
      "DependsOn": [
        "albalblistenerA15D02F3"
      ],
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/fargate-service/Service"
      }
    },
    "fargateserviceTaskCountTarget0BC3257A": {
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
      "Properties": {
        "MaxCapacity": 10,
        "MinCapacity": 1,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "EcsCluster97242B84"
              },
              "/",
              {
                "Fn::GetAtt": [
                  "fargateserviceService16837280",
                  "Name"
                ]
              }
            ]
          ]
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":iam::904766938874:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService"
            ]
          ]
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs"
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/fargate-service/TaskCount/Target/Resource"
      }
    },
    "fargateserviceTaskCountTargetScaleUpMem59CB9038": {
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
      "Properties": {
        "PolicyName": "whitespacewebtemplatefargatefargateserviceTaskCountTargetScaleUpMemD10F27E4",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fargateserviceTaskCountTarget0BC3257A"
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageMemoryUtilization"
          },
          "ScaleInCooldown": 60,
          "ScaleOutCooldown": 60,
          "TargetValue": 75
        }
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/fargate-service/TaskCount/Target/ScaleUpMem/Resource"
      }
    },
    "fargateserviceTaskCountTargetScaleUpCPU72368747": {
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
      "Properties": {
        "PolicyName": "whitespacewebtemplatefargatefargateserviceTaskCountTargetScaleUpCPU450B0BC7",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "fargateserviceTaskCountTarget0BC3257A"
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization"
          },
          "ScaleInCooldown": 60,
          "ScaleOutCooldown": 60,
          "TargetValue": 75
        }
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/fargate-service/TaskCount/Target/ScaleUpCPU/Resource"
      }
    },
    "alb8A8B13C2": {
      "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
      "Properties": {
        "LoadBalancerAttributes": [
          {
            "Key": "deletion_protection.enabled",
            "Value": "false"
          }
        ],
        "Scheme": "internet-facing",
        "SecurityGroups": [
          {
            "Fn::GetAtt": [
              "albSecurityGroup49866104",
              "GroupId"
            ]
          },
          {
            "Fn::GetAtt": [
              "albsecuritygroup4B3C20F7",
              "GroupId"
            ]
          }
        ],
        "Subnets": [
          "p-12345",
          "p-67890"
        ],
        "Type": "application"
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/alb/Resource"
      }
    },
    "albSecurityGroup49866104": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Automatically created Security Group for ELB whitespacewebtemplatefargatealb1022EDD8",
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow from anyone on port 80",
            "FromPort": 80,
            "IpProtocol": "tcp",
            "ToPort": 80
          }
        ],
        "VpcId": "vpc-12345"
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/alb/SecurityGroup/Resource"
      }
    },
    "albSecurityGrouptowhitespacewebtemplatefargateecssecuritygroup643C3B3580D8A77EC3": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": {
          "Fn::GetAtt": [
            "albSecurityGroup49866104",
            "GroupId"
          ]
        },
        "IpProtocol": "tcp",
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": {
          "Fn::GetAtt": [
            "ecssecuritygroupE15CB9D2",
            "GroupId"
          ]
        },
        "FromPort": 80,
        "ToPort": 80
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/alb/SecurityGroup/to whitespacewebtemplatefargateecssecuritygroup643C3B35:80"
      }
    },
    "albalblistenerA15D02F3": {
      "Type": "AWS::ElasticLoadBalancingV2::Listener",
      "Properties": {
        "DefaultActions": [
          {
            "TargetGroupArn": {
              "Ref": "targetgrouphttp79FCCF53"
            },
            "Type": "forward"
          }
        ],
        "LoadBalancerArn": {
          "Ref": "alb8A8B13C2"
        },
        "Port": 80,
        "Protocol": "HTTP"
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/alb/alb-listener/Resource"
      }
    },
    "albRedirect80To44345967F5A": {
      "Type": "AWS::ElasticLoadBalancingV2::Listener",
      "Properties": {
        "DefaultActions": [
          {
            "RedirectConfig": {
              "Port": "443",
              "Protocol": "HTTPS",
              "StatusCode": "HTTP_301"
            },
            "Type": "redirect"
          }
        ],
        "LoadBalancerArn": {
          "Ref": "alb8A8B13C2"
        },
        "Port": 80,
        "Protocol": "HTTP"
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/alb/Redirect80To443/Resource"
      }
    },
    "targetgrouphttp79FCCF53": {
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties": {
        "HealthCheckPath": "/",
        "HealthCheckProtocol": "HTTP",
        "Port": 80,
        "Protocol": "HTTP",
        "TargetType": "ip",
        "VpcId": "vpc-12345"
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/target-group-http/Resource"
      }
    },
    "albsecuritygroup4B3C20F7": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "whitespace-web-template-fargate/alb-security-group",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow https traffic",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443
          }
        ],
        "VpcId": "vpc-12345"
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/alb-security-group/Resource"
      }
    },
    "CDKMetadata": {
      "Type": "AWS::CDK::Metadata",
      "Properties": {
        "Analytics": "v2:deflate64:H4sIAAAAAAAA/31R227CMAz9Ft5DGGgarxvdRZOQNrX8QAimMoS4yoUJVf33OS2FwqQ9+fic48SXqZzO5vJh9Kx+/Fhv9pNakwNZF0HpvcjBU3QaRLa1XzFUMYiMrA8u6pC4Xm9EKq9Be1lnJvoALsk9fFeuVAFWyu9fYYsWA5JNhnuGbFBowQ24c20B7ohdIz0stDJqbdpnM4o2NALVQdY5mdbXxm8yqE8p7VAjQDuZQ0UeA7nTQnkQhkpufEnlh6NYJXOPk33G2wAdHYbTRf+f+LSlA+//8G8tzcuqKu5FpflUDOR5ELQlf3OZyJXQLviO6cLK8W24oOjqriPeENy6UT6gNqQ2a37GataOPM3L9fsla4tW6y52kw99yIe0Z0+PB3rX2GUbg7RpGmFpA3LnJ8fpo5zO5dNo5xHHjk+GB5B5F38BC9rc9ooCAAA="
      },
      "Metadata": {
        "aws:cdk:path": "whitespace-web-template-fargate/CDKMetadata/Default"
      }
    }
  },
  "Outputs": {
    "fargateclustersecuritygroupid": {
      "Description": "ID of Security Group used by Fargate Cluster",
      "Value": {
        "Fn::GetAtt": [
          "ecssecuritygroupE15CB9D2",
          "GroupId"
        ]
      },
      "Export": {
        "Name": "whitespace-web-template-FargateClusterSecurityGroupId"
      }
    },
    "FargateClusterVpcId": {
      "Description": "ID of VPC used by Fargate Cluster",
      "Value": "vpc-12345",
      "Export": {
        "Name": "whitespace-web-template-FargateClusterVpcId"
      }
    },
    "FargateClusterContainerName": {
      "Value": "container",
      "Export": {
        "Name": "whitespace-web-template-FargateClusterContainerName"
      }
    },
    "FargateClusterArn": {
      "Description": "ARN of Cluster used in Fargate Service",
      "Value": {
        "Fn::GetAtt": [
          "EcsCluster97242B84",
          "Arn"
        ]
      },
      "Export": {
        "Name": "whitespace-web-template-FargateClusterArn"
      }
    },
    "FargateClusterName": {
      "Description": "Name of Cluster used in Fargate Service",
      "Value": {
        "Ref": "EcsCluster97242B84"
      },
      "Export": {
        "Name": "whitespace-web-template-FargateClusterName"
      }
    },
    "FargateServiceName": {
      "Value": {
        "Fn::GetAtt": [
          "fargateserviceService16837280",
          "Name"
        ]
      },
      "Export": {
        "Name": "whitespace-web-template-FargateServiceName"
      }
    },
    "FargateServiceArn": {
      "Description": "ARN of Fargate Service",
      "Value": {
        "Ref": "fargateserviceService16837280"
      },
      "Export": {
        "Name": "whitespace-web-template-FargateServiceArn"
      }
    }
  },
  "Parameters": {
    "BootstrapVersion": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store."
    }
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5"
                  ],
                  {
                    "Ref": "BootstrapVersion"
                  }
                ]
              }
            ]
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
        }
      ]
    }
  }
}